{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"/Users/meee_pooh/Desktop/PunchUp/bkk-followup/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { isMobileOnly, isMobile } from 'react-device-detect';\nimport * as d3 from 'd3';\nimport close_img from '../../assets/images/close_map.svg';\n\nvar map = function map(_ref) {\n  var selected_year = _ref.selected_year,\n      selected_theme = _ref.selected_theme,\n      data = _ref.data,\n      state_dropdown = _ref.state_dropdown,\n      checked = _ref.checked,\n      raw_data = _ref.raw_data,\n      SET_DISTRICT = _ref.SET_DISTRICT,\n      district = _ref.district;\n\n  var actived_tool_tip = function actived_tool_tip(name) {\n    SET_DISTRICT(name);\n  };\n\n  var disable_tool_tip = function disable_tool_tip(name) {\n    d3.select(\".rect\".concat(name)).style('stroke', 'none');\n    d3.select(\".minimap\".concat(name)).style('fill', 'black');\n    d3.select(\".tooltip\".concat(name)).style('visibility', 'hidden');\n    SET_DISTRICT(null);\n  };\n\n  var mouseover = function mouseover(_, d) {\n    if (!isMobile) {\n      if (d.districtName != district) {\n        d3.select(\".rect\".concat(d.districtName)).style('stroke-width', 1).style('stroke', 'white');\n        d3.select(\".minimap\".concat(d.districtName)).style('fill', 'white');\n        d3.select(\".tooltip\".concat(d.districtName)).style('visibility', 'visible');\n      }\n    }\n  };\n\n  var mouseout = function mouseout(d) {\n    if (!isMobile) {\n      if (state_dropdown === 'group' && checked != 'เขตพื้นที่ทั้งหมด') {\n        if (!_.some(raw_data.rankings, {\n          districtName: d.districtName\n        })) {\n          d3.select(\".rect\".concat(d.districtName)).style('stroke', 'none');\n          d3.select(\".minimap\".concat(d.districtName)).style('fill', 'black');\n          d3.select(\".tooltip\".concat(d.districtName)).style('visibility', 'hidden');\n        }\n      } else {\n        if (district != d.districtName) {\n          d3.select(\".rect\".concat(d.districtName)).style('stroke', 'none');\n          d3.select(\".minimap\".concat(d.districtName)).style('fill', 'black');\n          d3.select(\".tooltip\".concat(d.districtName)).style('visibility', 'hidden');\n        }\n      }\n    }\n  };\n\n  var color = function color(d) {\n    if (d > 100) {\n      return '#1570FF';\n    } else if (d > 80) {\n      return '#3A87FF';\n    } else if (d > 60) {\n      return '#609EFF';\n    } else if (d > 40) {\n      return '#85B5FF';\n    } else if (d > 20) {\n      return '#ABCCFF';\n    } else if (d > 0) {\n      return '#D0E2FF';\n    }\n  };\n\n  var box_width = isMobileOnly ? 30 : 50;\n  var box_gap = isMobileOnly ? 2 : 3;\n  var r_max = isMobileOnly ? 15 : 20;\n  var bkk_width = 11;\n  var bkk_height = 8;\n  var r_scale = d3.scaleSqrt().range([0, r_max]);\n\n  var cx = function cx(d) {\n    return (+d.X - 1) * (box_width + box_gap) + box_width / 2;\n  };\n\n  var cy = function cy(d) {\n    return (+d.Y - 1) * (box_width + box_gap) + box_width / 2;\n  };\n\n  var add_map = function add_map(parent, data, ref, colors, year) {\n    var unit, tool_top, tool_bot, avg;\n\n    if (selected_theme.name === 'น้ำท่วมถนน') {\n      unit = 'ครั้ง';\n      tool_top = 'ระดับน้ำท่วมบนถนน';\n      tool_bot = 'โดยเฉลี่ย';\n    } else if (selected_theme.name === 'พื้นที่สีเขียว') {\n      unit = 'ตร.ม./คน';\n      tool_top = 'ปริมาณ';\n      tool_bot = 'พื้นที่สีเขียว';\n      avg = '9';\n    } else if (selected_theme.name === 'มลพิษในคลอง') {\n      unit = 'มก./ลิตร';\n      tool_top = 'ปริมาณ';\n      tool_bot = 'มลพิษในคลอง';\n      avg = '15';\n    } else if (selected_theme.name === 'ขยะมูลฝอย') {\n      unit = 'กก./คน/วัน';\n      tool_top = 'ปริมาณ';\n      tool_bot = 'ขยะมูลฝอย';\n      avg = '1.864';\n    } else if (selected_theme.name === 'ฝุ่นควันเกินมาตรฐาน') {\n      unit = 'มค.ก./ลบ.ม.';\n      tool_top = 'ปริมาณ';\n      tool_bot = 'ฝุ่นควันเกินมาตรฐาน';\n      avg = '25';\n    }\n\n    r_scale.domain([0, d3.max(data, function (d) {\n      return +d.value;\n    })]);\n    d3.select('#maps').style('width', bkk_width * box_width + (bkk_width - 1) * box_gap + 'px').style('height', bkk_height * box_width + (bkk_height - 1) * box_gap + 'px');\n    var map = parent.append('svg').attr('class', year + ' ' + 'svg-wrapper').style('display', year === selected_year ? 'block' : 'none').attr('width', bkk_width * box_width + (bkk_width - 1) * box_gap).attr('height', bkk_height * box_width + (bkk_height - 1) * box_gap);\n    map.selectAll('g').data(data).join(function (enter) {\n      var group = enter.append('g').attr('transform', function (d) {\n        return \"translate(\".concat(cx(d), \", \").concat(cy(d), \")\");\n      });\n      group.append('rect').attr('class', function (d) {\n        return \"group_circle rect\".concat(d.districtName);\n      }).attr('width', box_width).attr('height', box_width).attr('x', -box_width / 2).attr('y', -box_width / 2).style('cursor', function (d) {\n        return d.value > 0 ? 'pointer' : '';\n      }).on('mouseover', function (e, d) {\n        return d.value ? mouseover(e, d) : '';\n      }).on('mouseout', function (_, d) {\n        return mouseout(d);\n      }).on('click', function (_, d) {\n        return d.value > 0 ? actived_tool_tip(d.districtName) : '';\n      });\n      group.append('circle').attr('r', function (d) {\n        return r_scale(+d.value);\n      }).style('pointer-events', 'none').style('fill', function (d) {\n        var value = +d.value;\n        if (value === ref) return colors[1];\n        if (value === 0) return null;\n        if (selected_theme.name === 'น้ำท่วมถนน') return color(d.value);\n        return value > ref ? colors[0] : colors[2];\n      });\n      group.append('circle').attr('r', r_scale(ref)).style('fill', 'none').style('stroke-width', function (d) {\n        return selected_theme.name === 'น้ำท่วมถนน' && d.value > 0 ? 0 : 1;\n      }).style('stroke', 'white').style('stroke-linecap', 'round').style('stroke-dasharray', '5 4').style('pointer-events', function (_) {\n        return 'none';\n      });\n      group.append('svg:image').attr('xlink:href', function (d) {\n        var value = +d.value;\n        return value === 0 ? close_img : '';\n      }).attr('x', function (_) {\n        return -3;\n      }).attr('y', function (_) {\n        return -3;\n      }).attr('height', 6).attr('width', 6).style('pointer-events', function (_) {\n        return 'none';\n      });\n      d3.select('#maps').append('div').attr('class', 'tool_tip_wrapper').selectAll('div').data(data).join(function (enter) {\n        var tooltip = enter.append('div').attr('class', function (d) {\n          return \"tool_tip_detail_wrapper rounded-lg tooltip\".concat(d.districtName);\n        }).style('top', function (d) {\n          if (isMobile) {\n            return cy(d) + 'px';\n          } else {\n            return cy(d) + 60 + 'px';\n          }\n        }).style('left', function (d) {\n          if (isMobileOnly) {\n            if (cx(d) < screen.width / 2) {\n              return cx(d) + 20 + 'px';\n            } else {\n              return cx(d) - 150 + 'px';\n            }\n          } else if (isMobile) {\n            if (cx(d) < screen.width / 2) {\n              return cx(d) + 120 + 'px';\n            } else {\n              return cx(d) - 130 + 'px';\n            }\n          } else {\n            return cx(d) + 40 + 'px';\n          }\n        }).style('visibility', function (d) {\n          return 'hidden';\n        });\n        var header = tooltip.append('div').attr('class', 'tooltip_header rounded-t-lg flex p3 font-bold').style('background', selected_theme.color);\n        header.append('div').attr('class', 'tooltip_h_left flex-1').append('div').text(function (d) {\n          return \"\\u0E40\\u0E02\\u0E15\".concat(d.districtName);\n        }).append('div').text(function (_) {\n          return \"\\u0E1B\\u0E35 25\".concat(selected_year);\n        });\n        header.append('div').attr('class', 'close_tooltip cursor-pointer').text(function (_) {\n          return 'x';\n        }).on('click', function (_, d) {\n          return disable_tool_tip(d.districtName);\n        });\n        var body = tooltip.append('div').attr('class', 'tooltip_body  flex leading-4 font-bold');\n        body.append('div').attr('class', 'tooltip_b_left p3 flex-1').append('div').text(function (_) {\n          return tool_top;\n        }).append('div').text(function (_) {\n          return tool_bot;\n        });\n        body.append('div').attr('class', 'tooltip_b_right flex text-right flex-1 justify-end').style('color', function (_) {\n          return selected_theme.text_color;\n        }).append('div').attr('class', 'tooltip_number p2').text(function (d) {\n          return d.value ? d.value : 0;\n        }).append('div').attr('class', 'tooltip_unit p3').text(function (_) {\n          return unit;\n        });\n        tooltip.append('div').attr('class', 'tooltip_footer rounded-b-lg flex p3  justify-center').text(function (d) {\n          if (d.value > avg) {\n            return \"\\u0E2A\\u0E39\\u0E07\\u0E01\\u0E27\\u0E48\\u0E32\\u0E04\\u0E48\\u0E32\\u0E40\\u0E09\\u0E25\\u0E35\\u0E48\\u0E22\";\n          } else if (d.value < avg) {\n            return \"\\u0E15\\u0E48\\u0E33\\u0E01\\u0E27\\u0E48\\u0E32\\u0E04\\u0E48\\u0E32\\u0E40\\u0E09\\u0E25\\u0E35\\u0E48\\u0E22\";\n          }\n        });\n      });\n    });\n  };\n\n  var run = function run() {\n    var unit;\n    var data_per_year = data.byYear;\n    var merge_data = [];\n    d3.csv('/bkk-election/data/map.csv').then(function (map) {\n      var selected_data = data_per_year[\"25\".concat(selected_year)];\n\n      _.forIn(selected_data, function (data) {\n        var d = map.find(function (m) {\n          return m.districtName === data.districtName;\n        });\n        merge_data.push(_objectSpread(_objectSpread({}, data), d));\n      });\n\n      if (selected_theme.name === 'พื้นที่สีเขียว') {\n        unit = 9;\n      } else if (selected_theme.name === 'มลพิษในคลอง') {\n        unit = 15;\n      } else if (selected_theme.name === 'ขยะมูลฝอย') {\n        unit = 1.8;\n      } else if (selected_theme.name === 'ฝุ่นควันเกินมาตรฐาน') {\n        unit = 37;\n      } else if (selected_theme.name === 'น้ำท่วมถนน') {\n        unit = d3.mean(merge_data, function (d) {\n          return +d.value;\n        });\n      }\n\n      var maps = d3.select('#maps');\n      d3.select('.svg-wrapper').remove();\n      d3.selectAll('.tool_tip_wrapper').remove();\n      add_map(maps, merge_data, unit, [selected_theme.color, '#CCF4DD', '#FFFFFF'], selected_year);\n\n      if (state_dropdown === 'group' && checked != 'เขตพื้นที่ทั้งหมด' && !district) {\n        _.forEach(raw_data.rankings, function (district) {\n          d3.select(\".rect\".concat(district.districtName)).style('stroke-width', 1).style('stroke', 'white');\n          d3.select(\".minimap\".concat(district.districtName)).style('fill', 'white');\n        });\n      } else if (district) {\n        d3.selectAll(\".minimap\").style('fill', 'none');\n        d3.selectAll('.tool_tip_detail_wrapper').style('visibility', 'hidden');\n        d3.selectAll(\".group_circle\").style('stroke', 'none');\n        d3.select(\".rect\".concat(district)).style('stroke-width', 1).style('stroke', 'white');\n        d3.select(\".minimap\".concat(district)).style('fill', 'white');\n        d3.select(\".tooltip\".concat(district)).style('visibility', 'visible');\n      }\n    });\n  };\n\n  run();\n  return /*#__PURE__*/_jsx(\"div\", {\n    className: \"relative flex items-center justify-center flex-1 m-auto my-5 lg:my-0\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      id: \"maps\"\n    })\n  });\n};\n\nexport default map;","map":null,"metadata":{},"sourceType":"module"}